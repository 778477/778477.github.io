<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Cocoa Launch at Login - 778477</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Cocoa Launch at Loginä»Mac Developer Libraryä¸­æŸ¥çœ‹æ–‡æ¡£ï¼š
æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æ·»åŠ ç™»å½•å¯åŠ¨é¡¹ï¼šä½¿ç”¨Service Management framework æˆ– ä½¿ç”¨ shared file list
è¿™ä¸¤ç§æ–¹å¼æœ‰å·®åˆ«ï¼š

ä½¿ç”¨Service Management framework åœ¨ç³»ç»Ÿçš„ç™»å½•é¡¹ä¸­æ˜¯ä¸å¯è§çš„ã€‚åªæœ‰å¸è½½Appæ‰èƒ½ç§»é™¤ç™»å½•é¡¹

ä½¿ç”¨ shared">
<meta property="og:type" content="article">
<meta property="og:title" content="Cocoa Launch at Login">
<meta property="og:url" content="http://yoursite.com/2016/02/29/2016-02-29-Cocoa Launch at Login/index.html">
<meta property="og:site_name" content="778477">
<meta property="og:description" content="Cocoa Launch at Loginä»Mac Developer Libraryä¸­æŸ¥çœ‹æ–‡æ¡£ï¼š
æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æ·»åŠ ç™»å½•å¯åŠ¨é¡¹ï¼šä½¿ç”¨Service Management framework æˆ– ä½¿ç”¨ shared file list
è¿™ä¸¤ç§æ–¹å¼æœ‰å·®åˆ«ï¼š

ä½¿ç”¨Service Management framework åœ¨ç³»ç»Ÿçš„ç™»å½•é¡¹ä¸­æ˜¯ä¸å¯è§çš„ã€‚åªæœ‰å¸è½½Appæ‰èƒ½ç§»é™¤ç™»å½•é¡¹

ä½¿ç”¨ shared">
<meta property="og:updated_time" content="2016-02-29T07:27:35.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cocoa Launch at Login">
<meta name="twitter:description" content="Cocoa Launch at Loginä»Mac Developer Libraryä¸­æŸ¥çœ‹æ–‡æ¡£ï¼š
æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æ·»åŠ ç™»å½•å¯åŠ¨é¡¹ï¼šä½¿ç”¨Service Management framework æˆ– ä½¿ç”¨ shared file list
è¿™ä¸¤ç§æ–¹å¼æœ‰å·®åˆ«ï¼š

ä½¿ç”¨Service Management framework åœ¨ç³»ç»Ÿçš„ç™»å½•é¡¹ä¸­æ˜¯ä¸å¯è§çš„ã€‚åªæœ‰å¸è½½Appæ‰èƒ½ç§»é™¤ç™»å½•é¡¹

ä½¿ç”¨ shared">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo logo-text" href="/">778477</a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-2016-02-29-Cocoa Launch at Login" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Cocoa Launch at Login
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/29/2016-02-29-Cocoa Launch at Login/" class="article-date">
  <time datetime="2016-02-29T00:00:00.000Z" itemprop="datePublished">2016-02-29</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cocoa-Launch-at-Login"><a href="#Cocoa-Launch-at-Login" class="headerlink" title="Cocoa Launch at Login"></a>Cocoa Launch at Login</h1><p>ä»<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLoginItems.html" target="_blank" rel="external">Mac Developer Library</a>ä¸­æŸ¥çœ‹æ–‡æ¡£ï¼š</p>
<p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æ·»åŠ ç™»å½•å¯åŠ¨é¡¹ï¼šä½¿ç”¨Service Management framework æˆ– ä½¿ç”¨ shared file list</p>
<p>è¿™ä¸¤ç§æ–¹å¼æœ‰å·®åˆ«ï¼š</p>
<ul>
<li><p>ä½¿ç”¨Service Management framework åœ¨ç³»ç»Ÿçš„ç™»å½•é¡¹ä¸­æ˜¯ä¸å¯è§çš„ã€‚åªæœ‰å¸è½½Appæ‰èƒ½ç§»é™¤ç™»å½•é¡¹</p>
</li>
<li><p>ä½¿ç”¨ shared file list åœ¨ç³»ç»Ÿçš„ç™»å½•é¡¹ä¸­æ˜¯å¯è§çš„ã€‚ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨é¢æ¿ä¸Šæ§åˆ¶ä»–ä»¬ã€‚ï¼ˆIf you use this API, your login item can be disabled by the user, so any other application that communicates with it it should have reasonable fallback behavior in case the login item is disabled.ï¼‰ åŸæ–‡è¿˜æœ‰ä¸€å¥å¤§æ„æ˜¯æŒ‡è¿™ä¸ªAPIæœ‰éšæ‚£ï¼Œæ‰€ä»¥åœ¨OS X 10.10ç³»ç»Ÿä¸Š APIè¢«å¤§é‡Deprecated</p>
</li>
</ul>
<p>ä¸‹é¢å…·ä½“ä»‹ç»ä¸€ä¸‹ è¿™ä¸¤ç§çš„å®ç°</p>
<h2 id="Adding-Login-Item-Using-the-Service-Management-Framework"><a href="#Adding-Login-Item-Using-the-Service-Management-Framework" class="headerlink" title="Adding Login Item Using the Service Management Framework"></a>Adding Login Item Using the Service Management Framework</h2><p>åº”ç”¨è¦åŒ…å«ä¸€ä¸ª Helper Targetï¼Œç±»å‹ä¹Ÿæ˜¯åº”ç”¨ã€‚è®¾ç½®è·¯å¾„ä¸ºContents/Library/LoginItemsã€‚è®¾ç½®è¿™ä¸ªHelper Target info.plist LSBackgroundOnly ä¸º YESã€‚</p>
<p>ä½¿ç”¨ <figure class="highlight plain"><figcaption><span>```æ–¹æ³•æˆæƒHelperï¼Œéœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š```CFStringRef```æŒ‡çš„æ˜¯Helper Targetçš„bundle identifier. ``` Boolean ``` è¡¨ç¤ºæœŸæœ›çŠ¶æ€ã€‚ ä¼ å…¥ ```true``` Helper ä¼šæ¯æ¬¡åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™å¯åŠ¨ã€‚ ä¼ å…¥``` false ``` æ¥æ³¨é”€è¿™ä¸ªç™»å½•é¡¹ï¼Œä¸ä¼šåœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™å¯åŠ¨ã€‚ è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªboolå€¼ï¼Œå¦‚æœæ˜¯tureçš„è¯ï¼Œè¯´æ˜æœŸæœ›çŠ¶æ€è®¾ç½®æˆåŠŸã€‚å¦‚æœæ˜¯falseçš„è¯ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªhelper</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æ¯”å¦‚ ä¸€ä¸ªå…¬å¸å‘å¸ƒè¿‡å¾ˆå¤šAppï¼Œä½†å…¶ä¸­çš„helper bundle identifieréƒ½æ˜¯ç›¸åŒçš„ã€‚ è¿™æ ·ä¼šå¯¼è‡´åœ¨åŒä¸€ä¸ªç”µè„‘ä¸Šåªæœ‰ä¸€ä¸ªApp(greatest bundle version number)èƒ½æˆåŠŸæ³¨å†Œç™»å½•é¡¹ã€‚</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ–¹å¼ï¼Œæˆ‘æœªå®è·µè¿‡ã€‚è´´å‡ ä¸ªç›¸å…³çš„åšæ–‡å§ï¼š</span><br><span class="line"></span><br><span class="line">[The Launch At Login Sandbox Project](http://blog.timschroeder.net/2012/07/03/the-launch-at-login-sandbox-project/)</span><br><span class="line"></span><br><span class="line">[Adding a preference to launch sandboxed app on login](http://rhult.github.io/articles/sandboxed-launch-on-login/)</span><br><span class="line"></span><br><span class="line">[åœ¨SandBoxæ²™ç›’ä¸‹å®ç°ç¨‹åºçš„å¼€æœºå¯åŠ¨](http://www.tanhao.me/pieces/590.html/)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Adding Login Items Using a Shared File List</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>(BOOL)isLaunchAtStartup {<br>  // See if the app is currently in LoginItems.<br>  LSSharedFileListItemRef itemRef = [self itemRefInLoginItems];<br>  // Store away that boolean.<br>  BOOL isInList = itemRef != nil;<br>  // Release the reference if it exists.<br>  if (itemRef != nil) CFRelease(itemRef);</p>
<p>  return isInList;<br>}</p>
</li>
<li><p>(IBAction)toggleLaunchAtStartup:(id)sender {<br>  // Toggle the state.<br>  BOOL shouldBeToggled = ![self isLaunchAtStartup];<br>  // Get the LoginItems list.<br>  LSSharedFileListRef loginItemsRef = LSSharedFileListCreate(NULL, kLSSharedFileListSessionLoginItems, NULL);<br>  if (loginItemsRef == nil) return;<br>  if (shouldBeToggled) {</p>
<pre><code>// Add the app to the LoginItems list.
CFURLRef appUrl = (__bridge CFURLRef)[NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]];
LSSharedFileListItemRef itemRef = LSSharedFileListInsertItemURL(loginItemsRef, kLSSharedFileListItemLast, NULL, NULL, appUrl, NULL, NULL);
if (itemRef) CFRelease(itemRef);
[[self.statusMenu itemAtIndex:0] setTitle:@&quot;å–æ¶ˆå¼€æœºè‡ªå¯åŠ¨&quot;];
</code></pre><p>  }<br>  else {</p>
<pre><code>// Remove the app from the LoginItems list.
LSSharedFileListItemRef itemRef = [self itemRefInLoginItems];
LSSharedFileListItemRemove(loginItemsRef,itemRef);
if (itemRef != nil) CFRelease(itemRef);
[[self.statusMenu itemAtIndex:0] setTitle:@&quot;è®¾ç½®å¼€æœºè‡ªå¯åŠ¨&quot;];
</code></pre><p>  }<br>  CFRelease(loginItemsRef);<br>}</p>
</li>
<li><p>(LSSharedFileListItemRef)itemRefInLoginItems {<br>  LSSharedFileListItemRef res = nil;</p>
<p>  // Get the appâ€™s URL.<br>  NSURL <em>bundleURL = [NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]];<br>  // Get the LoginItems list.<br>  LSSharedFileListRef loginItemsRef = LSSharedFileListCreate(NULL, kLSSharedFileListSessionLoginItems, NULL);<br>  if (loginItemsRef == nil) return nil;<br>  // Iterate over the LoginItems.<br>  NSArray </em>loginItems = (__bridge NSArray *)LSSharedFileListCopySnapshot(loginItemsRef, nil);<br>  for (id item in loginItems) {</p>
<pre><code>LSSharedFileListItemRef itemRef = (__bridge LSSharedFileListItemRef)(item);
CFURLRef itemURLRef;
if (LSSharedFileListItemResolve(itemRef, 0, &amp;itemURLRef, NULL) == noErr) {
    // Again, use toll-free bridging.
    NSURL *itemURL = (__bridge NSURL *)itemURLRef;
    if ([itemURL isEqual:bundleURL]) {
        res = itemRef;
        break;
    }
}
</code></pre><p>  }<br>  // Retain the LoginItem reference.<br>  if (res != nil) CFRetain(res);<br>  CFRelease(loginItemsRef);<br>  CFRelease((__bridge CFTypeRef)(loginItems));</p>
<p>  return res;<br>}</p>
</li>
</ul>
<p>```</p>
<p><a href="http://bdunagan.com/2010/09/25/cocoa-tip-enabling-launch-on-startup/" target="_blank" rel="external">launch on startup</a></p>
<p><strong> ä¸»è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ä»¥ä¸Šæ–¹æ³•å¤§éƒ½æ˜¯ Deprecated in OS X V10.10 æ‰€ä»¥å¦‚æœä½ è¦å¼€å‘Deployment Target 10.10 ä»¥ä¸Šçš„Appçš„è¯ä¸æ¨èä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚æ˜¾ç„¶è¿™äº›APIåœ¨ä¹‹åçš„OS Xæ›´æ–°ç‰ˆæœ¬ä¸­ï¼Œå°†ä¼šæ— æ³•è°ƒç”¨ã€‚å¯¼è‡´ä½ çš„Appå‡ºç°ç¼–è¯‘é—®é¢˜ã€‚ </strong></p>
<p>å½“ç„¶ä»‹äºè¿™ä¸ªæ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä½ ä»ç„¶æƒ³ä½¿ç”¨çš„è¯ã€‚ä½ å¯ä»¥è®¾ç½®Deployment Targetä¸º 10.9 æ¥ä½¿ç”¨è¿™äº›åœ¨ 10.10è¢«åºŸå¼ƒçš„APIã€‚æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æˆ‘å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼ŒğŸ˜Š</p>
<h2 id="Deprecated-APIs"><a href="#Deprecated-APIs" class="headerlink" title="Deprecated APIs"></a>Deprecated APIs</h2><p>In previous versions of OS X, it is possible to add login items by sending an Apple event, by using the CFPreferences API, and by manually editing a property list file. These approaches are deprecated.</p>
<p>If you need to maintain compatibility with versions of OS X prior to v10.5, the preferred approach is to use Apple events; for details, see LoginItemsAE. Using the CFPreferences API is an acceptable alternative. You should not directly edit the property list file on any version of OS X.</p>
<p>æ—©äº› OS Xç‰ˆæœ¬çš„API å’Œå®ç°æ–¹å¼ï¼Œç°åœ¨ä¹Ÿè®¸è¡Œä¸é€šäº†ã€‚æˆ‘å°±ä¸ç¿»è¯‘äº†ã€‚ </p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocoa/">Cocoa</a></li></ul>

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/03/30/2016-03-30-Cocoa Auto Update/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          Cocoa auto update
        
      </div>
    </a>
  
  
    <a href="/2016/02/02/2016-02-02-Range Sum Query - Mutable/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Range Sum Query Mutable&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 miaoyou.gmy&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div>
</body>
</html>