<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>778477</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="778477">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="778477">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="778477">
<meta name="twitter:description">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo logo-text" href="/">778477</a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer">
      <article id="post-2016-05-28-Word Search II" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/28/2016-05-28-Word Search II/">Word Search II</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/05/28/2016-05-28-Word Search II/" class="article-date">
  <time datetime="2016-05-28T00:00:00.000Z" itemprop="datePublished">2016-05-28</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a><span>></span><a class="article-category-link" href="/categories/Algorithm/LeetCode/">LeetCode</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://leetcode.com/problems/word-search-ii/" target="_blank" rel="external">Word Search</a></p>
<blockquote>
<p>Given a 2D board and a list of words from the dictionary, find all words in the board.</p>
<p>Each word must be constructed from letters of sequentially adjacent cell, where “adjacent” cells are those horizontally or vertically neighboring. The same letter cell may not be used more than once in a word.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">For example,</span><br><span class="line">Given words = [&quot;oath&quot;,&quot;pea&quot;,&quot;eat&quot;,&quot;rain&quot;] and board =</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  [&apos;o&apos;,&apos;a&apos;,&apos;a&apos;,&apos;n&apos;],</span><br><span class="line">  [&apos;e&apos;,&apos;t&apos;,&apos;a&apos;,&apos;e&apos;],</span><br><span class="line">  [&apos;i&apos;,&apos;h&apos;,&apos;k&apos;,&apos;r&apos;],</span><br><span class="line">  [&apos;i&apos;,&apos;f&apos;,&apos;l&apos;,&apos;v&apos;]</span><br><span class="line">]</span><br><span class="line">Return [&quot;eat&quot;,&quot;oath&quot;].</span><br></pre></td></tr></table></figure>
<p>题目大意：给定一个二维面板和一组字符串，找出二维面板上存在的字符串。<br><strong>必须使用面板上的字母且水平连续或垂直连续拼接单词。</strong></p>
<h2 id="思路1：-深度优先搜索-DFS-Time-Limit-Exceeded"><a href="#思路1：-深度优先搜索-DFS-Time-Limit-Exceeded" class="headerlink" title="思路1： 深度优先搜索(DFS)  Time Limit Exceeded"></a>思路1： 深度优先搜索(DFS)  <span style="color:red">Time Limit Exceeded</span></h2><p>先遍历每个单词，如果单词首字母面板上有存在则开始深度优先搜索单词剩余的字母。</p>
<p>来分析一下超时的Test Case：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[&quot;aaaa&quot;,&quot;aaaa&quot;,&quot;aaaa&quot;,&quot;aaaa&quot;,&quot;bcde&quot;,&quot;fghi&quot;,&quot;jklm&quot;,&quot;nopq&quot;,&quot;rstu&quot;,&quot;vwxy&quot;,&quot;zzzz&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[&quot;aaaaaaaaaaaaaaaa&quot;,&quot;aaaaaaaaaaaaaaab&quot;,&quot;aaaaaaaaaaaaaaac&quot;,&quot;aaaaaaaaaaaaaaad&quot;,&quot;aaaaaaaaaaaaaaae&quot;,&quot;aaaaaaaaaaaaaaaf&quot;,&quot;aaaaaaaaaaaaaaag&quot;,&quot;aaaaaaaaaaaaaaah&quot;,&quot;aaaaaaaaaaaaaaai&quot;,&quot;aaaaaaaaaaaaaaaj&quot;,&quot;aaaaaaaaaaaaaaak&quot;,&quot;aaaaaaaaaaaaaaal&quot;,&quot;aaaaaaaaaaaaaaam&quot;,&quot;aaaaaaaaaaaaaaan&quot;,&quot;aaaaaaaaaaaaaaao&quot;,&quot;aaaaaaaaaaaaaaap&quot;,&quot;aaaaaaaaaaaaaaaq&quot;,&quot;aaaaaaaaaaaaaaar&quot;,&quot;aaaaaaaaaaaaaaas&quot;,&quot;aaaaaaaaaaaaaaat&quot;,&quot;aaaaaaaaaaaaaaau&quot;,&quot;aaaaaaaaaaaaaaav&quot;,&quot;aaaaaaaaaaaaaaaw&quot;,&quot;aaaaaaaaaaaaaaax&quot;,&quot;aaaaaaaaaaaaaaay&quot;,&quot;aaaaaaaaaaaaaaaz&quot;,&quot;aaaaaaaaaaaaaaaa&quot;,&quot;aaaaaaaaaaaaaaab&quot;,&quot;aaaaaaaaaaaaaaac&quot;,&quot;aaaaaaaaaaaaaaad&quot;,&quot;aaaaaaaaaaaaaaae&quot;,&quot;aaaaaaaaaaaaaaaf&quot;,&quot;aaaaaaaaaaaaaaag&quot;,&quot;aaaaaaaaaaaaaaah&quot;,&quot;aaaaaaaaaaaaaaai&quot;,&quot;aaaaaaaaaaaaaaaj&quot;,&quot;aaaaaaaaaaaaaaak&quot;,&quot;aaaaaaaaaaaaaaal&quot;,&quot;aaaaaaaaaaaaaaam&quot;,&quot;aaaaaaaaaaaaaaan&quot;,&quot;aaaaaaaaaaaaaaao&quot;,&quot;aaaaaaaaaaaaaaap&quot;,&quot;aaaaaaaaaaaaaaaq&quot;,&quot;aaaaaaaaaaaaaaar&quot;,&quot;aaaaaaaaaaaaaaas&quot;,&quot;aaaaaaaaaaaaaaat&quot;,&quot;aaaaaaaaaaaaaaau&quot;,&quot;aaaaaaaaaaaaaaav&quot;,&quot;aaaaaaaaaaaaaaaw&quot;,&quot;aaaaaaaaaaaaaaax&quot;,&quot;aaaaaaaaaaaaaaay&quot;,&quot;aaaaaaaaaaaaaaaz&quot;,&quot;aaaaaaaaaaaaaaba&quot;,&quot;aaaaaaaaaaaaaabb&quot;,&quot;aaaaaaaaaaaaaabc&quot;]</span><br></pre></td></tr></table></figure>
<p>发现这个Test Case很有意思，有大量重复相同的前缀<code>aaaaaaaaaaaaaaaa</code>。使用DFS遍历图的话，如果没有高效的剪枝策略。光是这个前缀的深度优先搜索效率就很低下了。</p>
<h2 id="思路2-：-字典树-Trie-深度优先搜索-DFS-Accepted"><a href="#思路2-：-字典树-Trie-深度优先搜索-DFS-Accepted" class="headerlink" title="思路2 ： 字典树(Trie) + 深度优先搜索(DFS) Accepted"></a>思路2 ： 字典树(Trie) + 深度优先搜索(DFS) <span style="color:green">Accepted</span></h2><p>建立Trie字典树，能有效的避免大量重复前缀的搜索。 </p>
<p>LeetCodeOJ 上有<a href="https://leetcode.com/problems/implement-trie-prefix-tree/" target="_blank" rel="external">关于Trie建树的题目</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const int TrieChildNodeMax(26);</span><br><span class="line">class Trie&#123;</span><br><span class="line">public:</span><br><span class="line">    class TrieNode&#123;</span><br><span class="line">    public:</span><br><span class="line">        TrieNode()&#123;</span><br><span class="line">            isWord = false;</span><br><span class="line">            word = &quot;&quot;;</span><br><span class="line">            memset(childNode, NULL, sizeof(TrieNode *) * TrieChildNodeMax);</span><br><span class="line">        &#125;</span><br><span class="line">        TrieNode *childNode[TrieChildNodeMax];</span><br><span class="line">        string word;</span><br><span class="line">        bool isWord;</span><br><span class="line">    &#125;;</span><br><span class="line">    TrieNode *root;</span><br><span class="line">    </span><br><span class="line">    Trie()&#123;</span><br><span class="line">        root = new TrieNode();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    void insert(const string word,TrieNode* node,int idx = 0)&#123;</span><br><span class="line">        if(idx == word.length()) return ;</span><br><span class="line">        int k = word[idx] - &apos;a&apos;;</span><br><span class="line">        if(node-&gt;childNode[k] == NULL)&#123;</span><br><span class="line">            node-&gt;childNode[k] = new TrieNode();</span><br><span class="line">        &#125;</span><br><span class="line">        if(idx == word.length() - 1)&#123;</span><br><span class="line">            node-&gt;childNode[k]-&gt;isWord = true;</span><br><span class="line">            node-&gt;childNode[k]-&gt;word = word;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            insert(word, node-&gt;childNode[k],idx+1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;string&gt; findWords(vector&lt;vector&lt;char&gt;&gt;&amp; board, vector&lt;string&gt;&amp; words) &#123;</span><br><span class="line">        vector&lt;string&gt; ans;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        for_each(words.begin(), words.end(), [&amp;](const string word)&#123;</span><br><span class="line">            trie.insert(word, trie.root);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        n = (int)board.size();</span><br><span class="line">        m = 0;</span><br><span class="line">        if(n &gt; 0) m = (int)board[0].size();</span><br><span class="line">        </span><br><span class="line">        for(int i=0;i&lt;n;i++)&#123;</span><br><span class="line">            for(int j=0;j&lt;m;j++)&#123;</span><br><span class="line">                memset(vis, false, sizeof(bool)*1024*1024);</span><br><span class="line">                if(boardHasWord(board,i,j,trie.root,ans))&#123;</span><br><span class="line">                    cout&lt;&lt;&quot;Yes,find word in borad&quot;&lt;&lt;endl;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        sort(ans.begin(), ans.end());</span><br><span class="line">        </span><br><span class="line">        return ans;</span><br><span class="line">    &#125;</span><br><span class="line">private:</span><br><span class="line">    bool judge(const int x,const int y)&#123;</span><br><span class="line">        return (x&gt;-1&amp;&amp;x&lt;n&amp;&amp;y&gt;-1&amp;&amp;y&lt;m&amp;&amp;!vis[x][y]);</span><br><span class="line">    &#125;</span><br><span class="line">    bool boardHasWord(const vector&lt;vector&lt;char&gt;&gt; board,int x,int y,Trie::TrieNode* root,vector&lt;string&gt;&amp; ans)&#123;</span><br><span class="line">        int k = board[x][y] - &apos;a&apos;;</span><br><span class="line">        vis[x][y] = true;</span><br><span class="line">        if(root-&gt;childNode[k])&#123;</span><br><span class="line">            if(root-&gt;childNode[k]-&gt;isWord)&#123;</span><br><span class="line">                root-&gt;childNode[k]-&gt;isWord = false;</span><br><span class="line">                ans.push_back(root-&gt;childNode[k]-&gt;word);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            for(int i=0;i&lt;4;i++)&#123;</span><br><span class="line">                int xx = x + dir[i][0];</span><br><span class="line">                int yy = y + dir[i][1];</span><br><span class="line">                </span><br><span class="line">                if(judge(xx, yy))&#123;</span><br><span class="line">                    vis[xx][yy] = true;</span><br><span class="line">                    if(boardHasWord(board, xx, yy, root-&gt;childNode[k], ans)) return true;</span><br><span class="line">                    vis[xx][yy] = false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    int n,m;</span><br><span class="line">    const int dir[4][2] = &#123; &#123;1,0&#125;,&#123;0,1&#125;,&#123;-1,0&#125;,&#123;0,-1&#125; &#125;;</span><br><span class="line">    bool vis[1024][1024];</span><br><span class="line">    Trie trie;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    </span><br><span class="line">    freopen(INPUT,&quot;r&quot;,stdin);</span><br><span class="line">    </span><br><span class="line">    string buf;</span><br><span class="line">    vector&lt;vector&lt;char&gt;&gt; board;</span><br><span class="line">    while(cin&gt;&gt;buf)&#123;</span><br><span class="line">        vector&lt;char&gt; chars;</span><br><span class="line">        chars.assign(buf.begin(), buf.end());</span><br><span class="line">        board.push_back(chars);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Solution solve;</span><br><span class="line">    vector&lt;string&gt; words(&#123;&quot;aaaaaaaaaaaaaaaa&quot;,&quot;aaaaaaaaaaaaaaab&quot;,&quot;aaaaaaaaaaaaaaac&quot;,&quot;aaaaaaaaaaaaaaad&quot;&#125;);</span><br><span class="line">    vector&lt;string&gt; ans = solve.findWords(board,words);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    for_each(ans.begin(), ans.end(), [](const string str)&#123;</span><br><span class="line">        cout&lt;&lt;str&lt;&lt;endl;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*	Wrong Answer */</span><br><span class="line">/*</span><br><span class="line">[&quot;ab&quot;,&quot;aa&quot;]</span><br><span class="line">[&quot;aba&quot;,&quot;baa&quot;,&quot;bab&quot;,&quot;aaab&quot;,&quot;aaa&quot;,&quot;aaaa&quot;,&quot;aaba&quot;]</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* Time Limit Exceeded */</span><br><span class="line">/*</span><br><span class="line"> </span><br><span class="line"> [&quot;aaaa&quot;,&quot;aaaa&quot;,&quot;aaaa&quot;,&quot;aaaa&quot;,&quot;bcde&quot;,&quot;fghi&quot;,&quot;jklm&quot;,&quot;nopq&quot;,&quot;rstu&quot;,&quot;vwxy&quot;,&quot;zzzz&quot;]</span><br><span class="line"> [&quot;aaaaaaaaaaaaaaaa&quot;,&quot;aaaaaaaaaaaaaaab&quot;,&quot;aaaaaaaaaaaaaaac&quot;,&quot;aaaaaaaaaaaaaaad&quot;]</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/Word_Search_II.png" alt="Accepted"></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/">LeetCode</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2016-04-25-House Robber" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/25/2016-04-25-House Robber/">House Robber</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/04/25/2016-04-25-House Robber/" class="article-date">
  <time datetime="2016-04-25T00:00:00.000Z" itemprop="datePublished">2016-04-25</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a><span>></span><a class="article-category-link" href="/categories/Algorithm/LeetCode/">LeetCode</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://leetcode.com/problems/house-robber/" target="_blank" rel="external">House Robber</a></p>
<blockquote>
<p>You are a professional robber planning to rob houses along a street. Each house has a certain amount of money stashed, the only constraint stopping you from robbing each of them is that adjacent houses have security system connected and it will automatically contact the police if two adjacent houses were broken into on the same night.</p>
<p>Given a list of non-negative integers representing the amount of money of each house, determine the maximum amount of money you can rob tonight without alerting the police.</p>
</blockquote>
<p>题目大意：你是一个职业强盗，计划去洗劫一条街。这条街上每个店铺都有一定量的现金。但是如果两家相邻的店铺被同时打劫的话会惊动警察。给定一个非负数数组表示各个店铺的现金数，请制定一个合理的打劫顺序使今晚的洗劫行动收获最大。</p>
<p>思考： </p>
<ol>
<li><strong>贪心策略</strong>：只洗劫奇数店铺 或 偶数店铺。 但细想一下，该策略只适合店铺数少于4的情况。比如有4家店铺的话： Plans = {[1,3],[2,4],[1,4]}；贪心策略的一个反例。</li>
<li><strong>暴力搜索</strong>：深度搜索，枚举每个店铺的两种状态： 抢 或 不抢。抢依赖上一家不抢。类似01背包，背包没有容量限制。<strong>可能会超时</strong></li>
<li>在想 思路2的时候，其实已经想到这是一个 动态规划的题了：）动规的时间复杂度比搜索要来的线性，稳定。动态方程式是 <code>dp[i] = max{dp[i-2]+nums[i],dp[i-1]} 2&lt;=i&lt;numsSize</code></li>
</ol>
<h2 id="动态规划-Accepted"><a href="#动态规划-Accepted" class="headerlink" title="动态规划 Accepted"></a>动态规划 <span style="color:green;">Accepted</span></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> a,<span class="keyword">const</span> <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">easyRob</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> odd = <span class="number">0</span>, eve = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;numsSize;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span>) eve += nums[i];</span><br><span class="line">        <span class="keyword">else</span> odd += nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> max(odd,eve);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(numsSize &lt;= <span class="number">3</span>) <span class="keyword">return</span> easyRob(nums,numsSize);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> *dp = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(numsSize));</span><br><span class="line">    <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(numsSize));</span><br><span class="line">    dp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">    dp[<span class="number">1</span>] = max(nums[<span class="number">1</span>],nums[<span class="number">0</span>]);</span><br><span class="line">    dp[<span class="number">2</span>] = max(dp[<span class="number">0</span>]+nums[<span class="number">2</span>],dp[<span class="number">1</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">3</span>;i&lt;numsSize;i++)&#123;</span><br><span class="line">        dp[i] = max(dp[i<span class="number">-2</span>]+nums[i],dp[i<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> ans = dp[numsSize<span class="number">-1</span>];</span><br><span class="line">    <span class="built_in">free</span>(dp);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/house_robber.png" alt=""></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/">LeetCode</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2016-04-08-Minimum Size Subarray Sum" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/08/2016-04-08-Minimum Size Subarray Sum/">Minimum Size Subarray Sum</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/04/08/2016-04-08-Minimum Size Subarray Sum/" class="article-date">
  <time datetime="2016-04-08T00:00:00.000Z" itemprop="datePublished">2016-04-08</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a><span>></span><a class="article-category-link" href="/categories/Algorithm/LeetCode/">LeetCode</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://leetcode.com/problems/minimum-size-subarray-sum/" target="_blank" rel="external">Minimum Size Subarray Sum</a></p>
<blockquote>
<p>Given an array of n positive integers and a positive integer s, find the minimal length of a subarray of which the sum ≥ s. If there isn’t one, return 0 instead.</p>
<p>For example, given the array [2,3,1,2,4,3] and s = 7,<br>the subarray [4,3] has the minimal length under the problem constraint.</p>
</blockquote>
<p>题目大意： 给定一个正数数组 nums和一个正数 s，找出最短长度的连续子数组 使其和 大于等于 s。如果没有的话，返回 0.</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="暴力枚举-Accepted"><a href="#暴力枚举-Accepted" class="headerlink" title="暴力枚举 Accepted"></a>暴力枚举 <span style="color:green;">Accepted</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    int minSubArrayLen(int s, vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        size_t n = nums.size();</span><br><span class="line">        int sum = 0;</span><br><span class="line">        int ans = INT_MAX;</span><br><span class="line">        for(int i=0;i&lt;n;i++)&#123;</span><br><span class="line">            sum = nums[i];</span><br><span class="line">            if(sum &gt;= s) return 1;</span><br><span class="line">            for(int j=i+1;j&lt;n;j++)&#123;</span><br><span class="line">                sum += nums[j];</span><br><span class="line">                if(sum &gt;= s)&#123;</span><br><span class="line">                    ans = min(ans,j-i+1);</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return ans==INT_MAX ? 0 : ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/Minimum%20Size%20Subarray%20Sum.png" alt=""></p>
<h2 id="暴力枚举-flag优化-Accepted"><a href="#暴力枚举-flag优化-Accepted" class="headerlink" title="暴力枚举 + flag优化 Accepted"></a>暴力枚举 + flag优化 <span style="color:green;">Accepted</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    int minSubArrayLen(int s, vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        size_t n = nums.size();</span><br><span class="line">        int sum = 0;</span><br><span class="line">        int ans = INT_MAX;</span><br><span class="line">        </span><br><span class="line">        bool flag;</span><br><span class="line">        for(int i=0;i&lt;n;i++)&#123;</span><br><span class="line">            sum = nums[i];</span><br><span class="line">            if(sum &gt;= s) return 1;</span><br><span class="line">            flag = false;</span><br><span class="line">            for(int j=i+1;j&lt;n;j++)&#123;</span><br><span class="line">                sum += nums[j];</span><br><span class="line">                if(sum &gt;= s)&#123;</span><br><span class="line">                    ans = min(ans,j-i+1);</span><br><span class="line">                    flag = true;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            if(!flag) break;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return ans==INT_MAX ? 0 : ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/Minimum%20Size%20Subarray%20Sum%202.png" alt=""></p>
<h2 id="枚举小窗口-Accepted"><a href="#枚举小窗口-Accepted" class="headerlink" title="枚举小窗口 Accepted"></a>枚举小窗口 <span style="color:green;">Accepted</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    int minSubArrayLen(int s, vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        size_t n = nums.size();</span><br><span class="line">        int sum = 0;</span><br><span class="line">        int ans = INT_MAX;</span><br><span class="line">        int p = 0,q = 0;</span><br><span class="line">        </span><br><span class="line">        while(q &lt; n)&#123;</span><br><span class="line">            sum += nums[q++];</span><br><span class="line">            </span><br><span class="line">            while(sum &gt;= s)&#123;</span><br><span class="line">                ans = min(ans,q-p);</span><br><span class="line">                sum -= nums[p++];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return ans==INT_MAX ? 0 : ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/Minimum%20Size%20Subarray%20Sum%203.png" alt=""></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/">LeetCode</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2016-03-30-Cocoa Auto Update" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/30/2016-03-30-Cocoa Auto Update/">Cocoa Auto Update</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/03/30/2016-03-30-Cocoa Auto Update/" class="article-date">
  <time datetime="2016-03-30T00:00:00.000Z" itemprop="datePublished">2016-03-30</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/macOS/">macOS</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cocoa-auto-update"><a href="#Cocoa-auto-update" class="headerlink" title="Cocoa auto update"></a>Cocoa auto update</h1><p>我们在进行Mac 桌面应用开发的时候，需要维护应用的更新。我们希望说每一次的新版本发布,用户都能够自动更新下载版本并且替换掉老版本。</p>
<p>首先需要一个文件服务器来存放 对外发布的软件压缩包。这里还维护一份releaseInfo.json对外描述已有的版本信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;app&quot;: &quot;MyApp&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;channels&quot;: [&quot;release&quot;],</span><br><span class="line">  &quot;entries&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;os&quot;: &quot;osx&quot;,</span><br><span class="line">      &quot;architectures&quot;: [&quot;x86-64&quot;],</span><br><span class="line">      &quot;osversion&quot;: &quot; &gt;= 10.6 &quot;,</span><br><span class="line">      &quot;appversion&quot;: &quot;1.0.0&quot;,</span><br><span class="line">      &quot;path&quot;: &quot;MyApp-1.0.0-osx.tar.gz&quot;,</span><br><span class="line">      &quot;format&quot;: &quot;gz&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端定时check版本信息，发现服务端有版本号大于自身版本号的时候 触发更新下载逻辑。 这里使用<code>NSURLSession</code>即可，下载过程不在这里描述了。</p>
<p>当我们自行下载完安装包之后，如何帮助用户自动安装呢?</p>
<p>我们下载完成之后，可用使用<code>NSTask</code>来调用一个 shell 脚本，让它来帮助我们结束老版本的进程，同时将下载好的新版本解压、拷贝内容到老版本的路径下、重新唤起App。 这个时候，app运行就是新版本的样式和逻辑</p>
<p>附上具体的shell脚本：</p>
<p><strong>注意需要传入的参数：tarball指的下载的安装包路径，destination指的当前app的bundlePath</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">function abort() &#123;</span><br><span class="line">    echo &quot;Update script aborted.&quot;</span><br><span class="line">    echo &quot;Removing temporary directory...&quot;</span><br><span class="line">    rm -rf $tempdir</span><br><span class="line">    echo &quot;Removing tarball...&quot;</span><br><span class="line">    rm -rf &quot;$tarball&quot;</span><br><span class="line">    echo &quot;Relaunching bundle...&quot;</span><br><span class="line">    open &quot;$destination&quot;</span><br><span class="line">    rm -f ~/.auto-update.lock</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tarball=$1</span><br><span class="line">destination=$2</span><br><span class="line"></span><br><span class="line">lockfile ~/.auto-update.lock</span><br><span class="line"></span><br><span class="line"># Step 1. Wait until all processes from within the bundle are closed</span><br><span class="line"></span><br><span class="line">processes=$(echo &quot;$(ps ax)&quot; | grep -v &quot;$0&quot;)</span><br><span class="line"># Escape the destination into a regexp that matches it</span><br><span class="line">regexp=$(echo &quot;$destination&quot; | sed &apos;s/[^[:alnum:]_-]/\\&amp;/g&apos;)</span><br><span class="line"># Filters entries matching the regexp, and do some magic to preserve the trailing newline</span><br><span class="line">matches=$(echo &quot;$processes&quot; | awk &quot;/$regexp/ &#123; print \$1 &#125;&quot;; echo .)</span><br><span class="line">matches=$&#123;matches%.&#125;</span><br><span class="line"># Count matches</span><br><span class="line">count=`printf &quot;%s&quot; &quot;$matches&quot; | wc -l`</span><br><span class="line">if [[ $count -gt 0 ]]; then</span><br><span class="line">    for pid in $matches</span><br><span class="line">    do</span><br><span class="line">        echo &quot;$pid&quot;</span><br><span class="line">        kill -9 &quot;$pid&quot;</span><br><span class="line">    done</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Step 2. Check if the downloaded tar is empty, if so abort</span><br><span class="line">if [ ! -s &quot;$tarball&quot; ]</span><br><span class="line">then</span><br><span class="line">    abort</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Step 3. Extract the new contents</span><br><span class="line">echo &quot;Creating temporary directory...&quot;</span><br><span class="line">tempdir=`mktemp -d /tmp/auto-update.XXXXX`</span><br><span class="line">echo &quot;Extracting new content from tarball...&quot;</span><br><span class="line">tar -xf &quot;$tarball&quot; -C &quot;$tempdir&quot;</span><br><span class="line"></span><br><span class="line"># Step 4. Check if the extraction worked, if not abort</span><br><span class="line">if [ $? -ne 0 ]</span><br><span class="line">then</span><br><span class="line">    abort</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Step 5. Remove the old bundle directory</span><br><span class="line">echo &quot;Removing bundle...&quot;</span><br><span class="line">rm -rf &quot;$destination&quot;/*</span><br><span class="line">echo &quot;Moving new content into place...&quot;</span><br><span class="line">mv -f $tempdir&apos;/&apos;$(ls $tempdir | head -n 1)&apos;/&apos;* &quot;$destination&quot;&apos;/&apos;</span><br><span class="line">echo &quot;Make sure destination is not quarantined...&quot;</span><br><span class="line">xattr -d com.apple.quarantine &quot;$destination&quot;</span><br><span class="line">echo &quot;Removing temporary directory...&quot;</span><br><span class="line">rm -rf $tempdir</span><br><span class="line">echo &quot;Removing tarball...&quot;</span><br><span class="line">rm -rf &quot;$tarball&quot;</span><br><span class="line"></span><br><span class="line"># Step 6. (Re)launch the destination bundle</span><br><span class="line">echo &quot;Relaunching bundle...&quot;</span><br><span class="line">open &quot;$destination&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;Done.&quot;</span><br><span class="line">rm -f ~/.auto-update.lock</span><br></pre></td></tr></table></figure>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://github.com/Automattic/auto-update" target="_blank" rel="external">https://github.com/Automattic/auto-update</a></li>
<li><a href="https://github.com/Automattic/auto-update-server" target="_blank" rel="external">https://github.com/Automattic/auto-update-server</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocoa/">Cocoa</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2016-02-29-Cocoa Launch at Login" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/29/2016-02-29-Cocoa Launch at Login/">Cocoa Launch at Login</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/29/2016-02-29-Cocoa Launch at Login/" class="article-date">
  <time datetime="2016-02-29T00:00:00.000Z" itemprop="datePublished">2016-02-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/macOS/">macOS</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cocoa-Launch-at-Login"><a href="#Cocoa-Launch-at-Login" class="headerlink" title="Cocoa Launch at Login"></a>Cocoa Launch at Login</h1><p>从<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLoginItems.html" target="_blank" rel="external">Mac Developer Library</a>中查看文档：</p>
<p>有两种方式可以添加登录启动项：使用Service Management framework 或 使用 shared file list</p>
<p>这两种方式有差别：</p>
<ul>
<li><p>使用Service Management framework 在系统的登录项中是不可见的。只有卸载App才能移除登录项</p>
</li>
<li><p>使用 shared file list 在系统的登录项中是可见的。用户可以直接在面板上控制他们。（If you use this API, your login item can be disabled by the user, so any other application that communicates with it it should have reasonable fallback behavior in case the login item is disabled.） 原文还有一句大意是指这个API有隐患，所以在OS X 10.10系统上 API被大量Deprecated</p>
</li>
</ul>
<p>下面具体介绍一下 这两种的实现</p>
<h2 id="Adding-Login-Item-Using-the-Service-Management-Framework"><a href="#Adding-Login-Item-Using-the-Service-Management-Framework" class="headerlink" title="Adding Login Item Using the Service Management Framework"></a>Adding Login Item Using the Service Management Framework</h2><p>应用要包含一个 Helper Target，类型也是应用。设置路径为Contents/Library/LoginItems。设置这个Helper Target info.plist LSBackgroundOnly 为 YES。</p>
<p>使用 <code>SMLoginItemSetEnabled</code>方法授权Helper，需要传入两个参数：<code>CFStringRef</code>指的是Helper Target的bundle identifier. <code>Boolean</code> 表示期望状态。 传入 <code>true</code> Helper 会每次在用户登录的时候启动。 传入<code>false</code> 来注销这个登录项，不会在用户登录的时候启动。 这个方法会返回一个bool值，如果是ture的话，说明期望状态设置成功。如果是false的话，可能存在多个helper</p>
<p>比如 一个公司发布过很多App，但其中的helper bundle identifier都是相同的。 这样会导致在同一个电脑上只有一个App(greatest bundle version number)能成功注册登录项。</p>
<p>这个方式，我未实践过。贴几个相关的博文吧：</p>
<p><a href="http://blog.timschroeder.net/2012/07/03/the-launch-at-login-sandbox-project/" target="_blank" rel="external">The Launch At Login Sandbox Project</a></p>
<p><a href="http://rhult.github.io/articles/sandboxed-launch-on-login/" target="_blank" rel="external">Adding a preference to launch sandboxed app on login</a></p>
<p><a href="http://www.tanhao.me/pieces/590.html/" target="_blank" rel="external">在SandBox沙盒下实现程序的开机启动</a></p>
<h2 id="Adding-Login-Items-Using-a-Shared-File-List"><a href="#Adding-Login-Items-Using-a-Shared-File-List" class="headerlink" title="Adding Login Items Using a Shared File List"></a>Adding Login Items Using a Shared File List</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)isLaunchAtStartup &#123;</span><br><span class="line">    // See if the app is currently in LoginItems.</span><br><span class="line">    LSSharedFileListItemRef itemRef = [self itemRefInLoginItems];</span><br><span class="line">    // Store away that boolean.</span><br><span class="line">    BOOL isInList = itemRef != nil;</span><br><span class="line">    // Release the reference if it exists.</span><br><span class="line">    if (itemRef != nil) CFRelease(itemRef);</span><br><span class="line">    </span><br><span class="line">    return isInList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (IBAction)toggleLaunchAtStartup:(id)sender &#123;</span><br><span class="line">    // Toggle the state.</span><br><span class="line">    BOOL shouldBeToggled = ![self isLaunchAtStartup];</span><br><span class="line">    // Get the LoginItems list.</span><br><span class="line">    LSSharedFileListRef loginItemsRef = LSSharedFileListCreate(NULL, kLSSharedFileListSessionLoginItems, NULL);</span><br><span class="line">    if (loginItemsRef == nil) return;</span><br><span class="line">    if (shouldBeToggled) &#123;</span><br><span class="line">        // Add the app to the LoginItems list.</span><br><span class="line">        CFURLRef appUrl = (__bridge CFURLRef)[NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]];</span><br><span class="line">        LSSharedFileListItemRef itemRef = LSSharedFileListInsertItemURL(loginItemsRef, kLSSharedFileListItemLast, NULL, NULL, appUrl, NULL, NULL);</span><br><span class="line">        if (itemRef) CFRelease(itemRef);</span><br><span class="line">        [[self.statusMenu itemAtIndex:0] setTitle:@&quot;取消开机自启动&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Remove the app from the LoginItems list.</span><br><span class="line">        LSSharedFileListItemRef itemRef = [self itemRefInLoginItems];</span><br><span class="line">        LSSharedFileListItemRemove(loginItemsRef,itemRef);</span><br><span class="line">        if (itemRef != nil) CFRelease(itemRef);</span><br><span class="line">        [[self.statusMenu itemAtIndex:0] setTitle:@&quot;设置开机自启动&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    CFRelease(loginItemsRef);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (LSSharedFileListItemRef)itemRefInLoginItems &#123;</span><br><span class="line">    LSSharedFileListItemRef res = nil;</span><br><span class="line">    </span><br><span class="line">    // Get the app&apos;s URL.</span><br><span class="line">    NSURL *bundleURL = [NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]];</span><br><span class="line">    // Get the LoginItems list.</span><br><span class="line">    LSSharedFileListRef loginItemsRef = LSSharedFileListCreate(NULL, kLSSharedFileListSessionLoginItems, NULL);</span><br><span class="line">    if (loginItemsRef == nil) return nil;</span><br><span class="line">    // Iterate over the LoginItems.</span><br><span class="line">    NSArray *loginItems = (__bridge NSArray *)LSSharedFileListCopySnapshot(loginItemsRef, nil);</span><br><span class="line">    for (id item in loginItems) &#123;</span><br><span class="line">        LSSharedFileListItemRef itemRef = (__bridge LSSharedFileListItemRef)(item);</span><br><span class="line">        CFURLRef itemURLRef;</span><br><span class="line">        if (LSSharedFileListItemResolve(itemRef, 0, &amp;itemURLRef, NULL) == noErr) &#123;</span><br><span class="line">            // Again, use toll-free bridging.</span><br><span class="line">            NSURL *itemURL = (__bridge NSURL *)itemURLRef;</span><br><span class="line">            if ([itemURL isEqual:bundleURL]) &#123;</span><br><span class="line">                res = itemRef;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // Retain the LoginItem reference.</span><br><span class="line">    if (res != nil) CFRetain(res);</span><br><span class="line">    CFRelease(loginItemsRef);</span><br><span class="line">    CFRelease((__bridge CFTypeRef)(loginItems));</span><br><span class="line">    </span><br><span class="line">    return res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://bdunagan.com/2010/09/25/cocoa-tip-enabling-launch-on-startup/" target="_blank" rel="external">launch on startup</a></p>
<p><strong> 主要特别注意的是以上方法大都是 Deprecated in OS X V10.10 所以如果你要开发Deployment Target 10.10 以上的App的话不推荐使用这个方法。显然这些API在之后的OS X更新版本中，将会无法调用。导致你的App出现编译问题。 </strong></p>
<p>当然介于这个方式比较简单，你仍然想使用的话。你可以设置Deployment Target为 10.9 来使用这些在 10.10被废弃的API。是没有问题的。我就是这么干的，😊</p>
<h2 id="Deprecated-APIs"><a href="#Deprecated-APIs" class="headerlink" title="Deprecated APIs"></a>Deprecated APIs</h2><p>In previous versions of OS X, it is possible to add login items by sending an Apple event, by using the CFPreferences API, and by manually editing a property list file. These approaches are deprecated.</p>
<p>If you need to maintain compatibility with versions of OS X prior to v10.5, the preferred approach is to use Apple events; for details, see LoginItemsAE. Using the CFPreferences API is an acceptable alternative. You should not directly edit the property list file on any version of OS X.</p>
<p>早些 OS X版本的API 和实现方式，现在也许行不通了。我就不翻译了。 </p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocoa/">Cocoa</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2016-02-02-Range Sum Query - Mutable" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/02/2016-02-02-Range Sum Query - Mutable/">Range Sum Query Mutable</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/02/2016-02-02-Range Sum Query - Mutable/" class="article-date">
  <time datetime="2016-02-02T00:00:00.000Z" itemprop="datePublished">2016-02-02</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a><span>></span><a class="article-category-link" href="/categories/Algorithm/LeetCode/">LeetCode</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://leetcode.com/problems/range-sum-query-mutable/" target="_blank" rel="external">Range Sum Query - Mutable</a></p>
<p>给定一个整形数组。会有两个操作</p>
<p>操作1：查询区间(i,j)的总和</p>
<p>操作2：更新元素(i,val) 下标为i的元素 值更新为val</p>
<p>提示：</p>
<ul>
<li>数组元素的修改只有通过 update 方法</li>
<li>update 和 sumRange 方法调用是不确定次数和顺序的（distributed evenly 分布式）</li>
</ul>
<p>这个是一个经典的问题。类似 RMQ(Range Minimum/Maximum Query)，区间最值查询。不过我们注意到有操作2，就表示说数据是可变的，离线算法就不考虑了。</p>
<p>这类题目有一个现成的数据结构可以解决：<a href="https://en.wikipedia.org/wiki/Segment_tree" target="_blank" rel="external">SegmentTree 线段树</a></p>
<p>由于线段树是平衡二叉树，所以深度是logn。就是算查询的区间和的时间复杂度是 O(logn)的。</p>
<p><img src="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/segment-tree1.png" alt="segment-tree1"></p>
<p>由上图可知，叶子节点均为数组元素。我们在做ACM题的常常会提到一个线段树常数，其实是指线段树的空间复杂度。按照数组n来推算线段树的空间复杂度。</p>
<p>时间复杂度大体分为： </p>
<ul>
<li>初始化 建树O(n) </li>
<li>区间查询和 O(logn) </li>
<li>更新单值O(logn) </li>
</ul>
<p>时间复杂度理想是线性的，不因为n的变化产生剧烈抖动。空间复杂度是O(nlogn)</p>
<blockquote>
<p>A segment tree T on a set I of n intervals uses O(nlogn) storage.</p>
<p>Proof:<br>Lemma: Any interval [x, x′] of I is stored in the canonical set for at most two nodes at the    same depth.</p>
<p>Proof: Let v1, v2, v3 be the three nodes at the same depth, numbered from left to right; and let p(v) be the parent node of any given node v. Suppose [x, x′] is stored at v1 and v3. This means that [x, x′] spans the whole interval from the left endpoint of Int(v1) to the right endpoint of Int(v3). Note that all segments at a particular level are non-overlapping and ordered from left to right: this is true by construction for the level containing the leaves, and the property is not lost when moving from any level to the one above it by combining pairs of adjacent segments. Now either p(v2) = p(v1), or the former is to the right of the latter (edges in the tree do not cross). In the first case, Int(p(v2))’s leftmost point is the same as Int(v1)’s leftmost point; in the second case, Int(p(v2))’s leftmost point is to the right of Int(p(v1))’s rightmost point, and therefore also to the right of Int(v1)’s rightmost point. In both cases, Int(p(v2)) begins at or to the right of Int(v1)’s leftmost point. Similar reasoning shows that Int(p(v2)) ends at or to the left of Int(v3)’s rightmost point. Int(p(v2)) must therefore be contained in [x, x′]; hence, [x, x′] will not be stored at v2.<br>The set I has at most 4n + 1 elementary intervals. Because T is a binary balanced tree with at most 4n + 1 leaves, its height is O(logn). Since any interval is stored at most twice at a given depth of the tree, that the total amount of storage is O(nlogn).</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">typedef unsigned long lusigned;</span><br><span class="line"></span><br><span class="line">struct SegmenTreeNode&#123;</span><br><span class="line">    int val;</span><br><span class="line">    lusigned star,end;</span><br><span class="line">    SegmenTreeNode *left,*right;</span><br><span class="line">    SegmenTreeNode(lusigned _star,lusigned _end,int _val)&#123;</span><br><span class="line">        val = _val;</span><br><span class="line">        star = _star, end = _end;</span><br><span class="line">        left = right = NULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class NumArray &#123;</span><br><span class="line">public:</span><br><span class="line">    NumArray(vector&lt;int&gt; &amp;nums) &#123;</span><br><span class="line">        numbers = nums;</span><br><span class="line">        if(nums.size() &gt;= 1)&#123;</span><br><span class="line">            rootNode = buildSegmentTree(0, 0, nums.size()-1, nums);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    void update(int i, int val)&#123;</span><br><span class="line">        updateNodeVal(rootNode, i, val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    int sumRange(int i, int j) &#123;</span><br><span class="line">        if(j &lt; i) return 0;</span><br><span class="line">        return querySumValInSegmentTree(rootNode, 0, numbers.size()-1, i, j);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">private:</span><br><span class="line">    vector&lt;int&gt; numbers;</span><br><span class="line">    SegmenTreeNode *rootNode;</span><br><span class="line">    SegmenTreeNode *buildSegmentTree(int root,lusigned star,lusigned end,const vector&lt;int&gt; nums)&#123;</span><br><span class="line">        </span><br><span class="line">        SegmenTreeNode *rootNode = new SegmenTreeNode(star, end, 0);</span><br><span class="line">        </span><br><span class="line">        if(star == end)&#123;</span><br><span class="line">            rootNode-&gt;val = nums[star];</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            lusigned mid = (star + end)/2;</span><br><span class="line">            rootNode-&gt;left = buildSegmentTree(root*2+1, star, mid, nums);</span><br><span class="line">            rootNode-&gt;right =  buildSegmentTree(root*2+2, mid+1, end, nums);</span><br><span class="line">            </span><br><span class="line">            rootNode-&gt;val = rootNode-&gt;left-&gt;val + rootNode-&gt;right-&gt;val;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return rootNode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    int updateNodeVal(SegmenTreeNode *root, int idx,int value)&#123;</span><br><span class="line">        if(root-&gt;star == root-&gt;end &amp;&amp; root-&gt;star == idx)  return (root-&gt;val = value);</span><br><span class="line">        else if(root-&gt;star == root-&gt;end) return root-&gt;val;</span><br><span class="line">        </span><br><span class="line">        lusigned mid = (root-&gt;star + root-&gt;end)&gt;&gt;1;</span><br><span class="line">        if(idx &lt;= mid)&#123;</span><br><span class="line">            root-&gt;left-&gt;val = updateNodeVal(root-&gt;left, idx, value);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            root-&gt;right-&gt;val = updateNodeVal(root-&gt;right, idx, value);</span><br><span class="line">        &#125;</span><br><span class="line">        return (root-&gt;val = root-&gt;left-&gt;val + root-&gt;right-&gt;val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    int querySumValInSegmentTree(SegmenTreeNode *root, lusigned star,lusigned end,lusigned qSidx,lusigned qEidx)&#123;</span><br><span class="line">        </span><br><span class="line">        if(qSidx &lt;= star &amp;&amp; qEidx &gt;= end) return root-&gt;val;</span><br><span class="line">        </span><br><span class="line">        if(qEidx &lt; star || qSidx &gt; end) return 0;</span><br><span class="line">        </span><br><span class="line">        lusigned mid = (star + end) / 2;</span><br><span class="line">        </span><br><span class="line">        int leftSumVal = querySumValInSegmentTree(root-&gt;left, star, mid, qSidx, qEidx);</span><br><span class="line">        int rightSumVal = querySumValInSegmentTree(root-&gt;right, mid+1, end, qSidx, qEidx);</span><br><span class="line">        </span><br><span class="line">        return leftSumVal + rightSumVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/Range%20Sum%20Query%20Accepted.png" alt="accepted"></p>
<p>不太明白为什么 leetCode Judge 中 C/C++ 的效率最低，Java最高。这个明显是不合理的。。</p>
<p>最后 关于 线段树的更新是有优化空间的。看一看这组操作</p>
<ol>
<li>操作1</li>
<li>操作2 </li>
<li>操作2</li>
<li>操作2</li>
<li>操作2</li>
<li>操作2</li>
<li>操作2</li>
</ol>
<p>其实 后面的操作2 如果没有接着操作1的话，其实我们没有必要实时更新单点值。这里就有一个延迟更新的优化点，也是线段树的精髓。 我之后有空补充:)</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/">LeetCode</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2015-12-16-Lighter View Controller" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/16/2015-12-16-Lighter View Controller/">Lighter View Controller</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/12/16/2015-12-16-Lighter View Controller/" class="article-date">
  <time datetime="2015-12-16T00:00:00.000Z" itemprop="datePublished">2015-12-16</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.objc.io/issues/1-view-controllers/lighter-view-controllers/" target="_blank" rel="external">Lighter-View-Controller 轻量级视图控制器</a></p>
<p>视图控制器们(View Controllers)通常是最大的文件在我们的iOS工程中。而且 他们常常有很多不必要的代码。导致视图控制器往往是无法在其他项目中复用的。我们下面讲述的技巧可以让控制器们 更加轻量，有复用性，让不合理的代码出现在合理的位置</p>
<p><a href="https://github.com/objcio/issue-1-lighter-view-controllers" target="_blank" rel="external">example project on GitHub</a></p>
<h3 id="分离出数据协议和其他接口协议"><a href="#分离出数据协议和其他接口协议" class="headerlink" title="分离出数据协议和其他接口协议"></a>分离出数据协议和其他接口协议</h3><ul>
<li>一个很有用的技巧就是将视图控制器中的 <code>UITableViewDataSource</code> 这部分代码分离出来。独立写一个类来维护，如果你都是这么处理的话，那么你这些类是可以以后在其他项目中复用的。</li>
<li>这样做还有一个好处就是，我们可以独立测试这个类。</li>
</ul>
<p>举个例子：在示例项目中，<code>PhotosViewController</code> 有这样几个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># pragma mark Pragma </span><br><span class="line"></span><br><span class="line">- (Photo*)photoAtIndexPath:(NSIndexPath*)indexPath &#123;</span><br><span class="line">    return photos[(NSUInteger)indexPath.row];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView*)tableView </span><br><span class="line"> numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    return photos.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell*)tableView:(UITableView*)tableView </span><br><span class="line">        cellForRowAtIndexPath:(NSIndexPath*)indexPath &#123;</span><br><span class="line">    PhotoCell* cell = [tableView dequeueReusableCellWithIdentifier:PhotoCellIdentifier </span><br><span class="line">                                                      forIndexPath:indexPath];</span><br><span class="line">    Photo* photo = [self photoAtIndexPath:indexPath];</span><br><span class="line">    cell.label.text = photo.name;</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>让我们试着把这些代码放到 我们自己的类上。我们用闭包来填充数据(或许协议更合适，这个取决于你)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@implementation ArrayDataSource</span><br><span class="line"></span><br><span class="line">- (id)itemAtIndexPath:(NSIndexPath*)indexPath &#123;</span><br><span class="line">    return items[(NSUInteger)indexPath.row];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView*)tableView </span><br><span class="line"> numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    return items.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell*)tableView:(UITableView*)tableView </span><br><span class="line">        cellForRowAtIndexPath:(NSIndexPath*)indexPath &#123;</span><br><span class="line">    id cell = [tableView dequeueReusableCellWithIdentifier:cellIdentifier</span><br><span class="line">                                              forIndexPath:indexPath];</span><br><span class="line">    id item = [self itemAtIndexPath:indexPath];</span><br><span class="line">    configureCellBlock(cell,item);</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>这三个方法不再存在我们的视图控制器了，我们可以创建实例来承接table view的数据协议委托</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void (^configureCell)(PhotoCell*, Photo*) = ^(PhotoCell* cell, Photo* photo) &#123;</span><br><span class="line">   cell.label.text = photo.name;</span><br><span class="line">&#125;;</span><br><span class="line">photosArrayDataSource = [[ArrayDataSource alloc] initWithItems:photos</span><br><span class="line">                                                cellIdentifier:PhotoCellIdentifier</span><br><span class="line">                                            configureCellBlock:configureCell];</span><br><span class="line">self.tableView.dataSource = photosArrayDataSource;</span><br></pre></td></tr></table></figure>
<p>而且，这种办法扩展其他接口协议也很方便。比如 另外的一个list数据协议是 <code>UICollectionViewDataSource</code> 由于一些需求实现，你们决定将 <code>UITableView</code> 替换为 <code>UICollectionView</code>。实际上你的视图控制器不需要任何改动，你可以让你的类都支持这两个数据协议。</p>
<h3 id="逻辑处理放在Model"><a href="#逻辑处理放在Model" class="headerlink" title="逻辑处理放在Model"></a>逻辑处理放在Model</h3><p> 这里还是一个例子，这些代码在view controller里，功能是返回一个列表，上面的数据是用户的活跃度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)loadPriorities &#123;</span><br><span class="line">  NSDate* now = [NSDate date];</span><br><span class="line">  NSString* formatString = @&quot;startDate &lt;= %@ AND endDate &gt;= %@&quot;;</span><br><span class="line">  NSPredicate* predicate = [NSPredicate predicateWithFormat:formatString, now, now];</span><br><span class="line">  NSSet* priorities = [self.user.priorities filteredSetUsingPredicate:predicate];</span><br><span class="line">  self.priorities = [priorities allObjects];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当这些代码被放置到 User类的扩展中时，view controller就看起来比较清爽了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)loadPriorities &#123;</span><br><span class="line">  self.priorities = [self.user currentPriorities];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>User+Extensions.m:</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray*)currentPriorities &#123;</span><br><span class="line">  NSDate* now = [NSDate date];</span><br><span class="line">  NSString* formatString = @&quot;startDate &lt;= %@ AND endDate &gt;= %@&quot;;</span><br><span class="line">  NSPredicate* predicate = [NSPredicate predicateWithFormat:formatString, now, now];</span><br><span class="line">  return [[self.priorities filteredSetUsingPredicate:predicate] allObjects];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然在实际项目中，有些代码不是那么轻松可以转移到Model当中的。所以我们要创建 “数据仓库”(Store Class)</p>
<h3 id="创建仓库类"><a href="#创建仓库类" class="headerlink" title="创建仓库类"></a>创建仓库类</h3><p>我们有些代码是从文件中加载数据并处理数据的，这些代码大概是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (void)readArchive &#123;</span><br><span class="line">    NSBundle* bundle = [NSBundle bundleForClass:[self class]];</span><br><span class="line">    NSURL *archiveURL = [bundle URLForResource:@&quot;photodata&quot;</span><br><span class="line">                                 withExtension:@&quot;bin&quot;];</span><br><span class="line">    NSAssert(archiveURL != nil, @&quot;Unable to find archive in bundle.&quot;);</span><br><span class="line">    NSData *data = [NSData dataWithContentsOfURL:archiveURL</span><br><span class="line">                                         options:0</span><br><span class="line">                                           error:NULL];</span><br><span class="line">    NSKeyedUnarchiver *unarchiver = [[NSKeyedUnarchiver alloc] initForReadingWithData:data];</span><br><span class="line">    _users = [unarchiver decodeObjectOfClass:[NSArray class] forKey:@&quot;users&quot;];</span><br><span class="line">    _photos = [unarchiver decodeObjectOfClass:[NSArray class] forKey:@&quot;photos&quot;];</span><br><span class="line">    [unarchiver finishDecoding];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实 View Controller 没有必要关心数据是如何处理的，我们创建 数据仓库来处理这些。使这些代码分离出来，这样我们就可以复用这个仓库类了。<br>独立测试并且View Controller的代码量又减少了一些。这些数据仓库负责数据处理，持久化和数据库交互。我们也可以叫这些”仓库”为服务层或资料库</p>
<h3 id="将网络服务逻辑转移到Model"><a href="#将网络服务逻辑转移到Model" class="headerlink" title="将网络服务逻辑转移到Model"></a>将网络服务逻辑转移到Model</h3><p>这是一个类似的优化逻辑：不要把网络交互放在View Controller。把这些逻辑独立放置在其他类中，可以调用方法并设置回调处理。<br>这样做的好处是你可以格外处理所有你的数据和错误在这个类上。而不会让View Controller变的臃肿</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>我们看到有很多技巧可以让View Controller更加精简。我们努力让这些技巧在实际开发中更加实用。<br>我们只有一个目的：写出可维护的代码。知道这些模式之后，我们有更加深刻的认识来讨论如何将笨重的View Controller精简优化。</p>
<h3 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h3><ul>
<li><a href="https://developer.apple.com/library/mac/documentation/General/Conceptual/DevPedia-CocoaCore/ControllerObject.html" target="_blank" rel="external">Cocoa Core Competencies: Controller Object</a></li>
<li><a href="http://subjective-objective-c.blogspot.de/2011/08/writing-high-quality-view-controller.html" target="_blank" rel="external">Writing high quality view controllers</a></li>
<li><a href="https://programmers.stackexchange.com/questions/184396/mvcs-model-view-controller-store" target="_blank" rel="external">Programmers Stack Exchange: Model View Controller Store</a></li>
<li><a href="https://programmers.stackexchange.com/questions/177668/how-to-avoid-big-and-clumsy-uitableviewcontroller-on-ios" target="_blank" rel="external">Programmers Stack Exchange: How to avoid big and clumsy UITableViewControllers on iOS
</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2015-11-27-Minimum Window Substring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/27/2015-11-27-Minimum Window Substring/">Minimum Window Substring</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/11/27/2015-11-27-Minimum Window Substring/" class="article-date">
  <time datetime="2015-11-27T00:00:00.000Z" itemprop="datePublished">2015-11-27</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a><span>></span><a class="article-category-link" href="/categories/Algorithm/LeetCode/">LeetCode</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://leetcode.com/problems/minimum-window-substring/" target="_blank" rel="external">Minimum Window Substring</a></p>
<p>题目大意：<br>给定一个字符串S 和 另一个字符串T，在S中找到一个最短长度的子串包含T中所有的字母。 时间期望是O(N)<br>如：<br><code>S = &quot;ADOBECODEBANC&quot;</code><br><code>T = &quot;ABC&quot;</code><br>最短子串是 <code>&quot;BANC&quot;</code></p>
<p>提示：</p>
<ul>
<li>如果没有找到子串，则返回<code>&quot;&quot;</code>空串</li>
<li>如果有多个满足条件的字串，题目保证最短子串只有唯一的一个</li>
</ul>
<p>思路：<br>维护一个计数数组CountTable统计字符串T所出现的所有字母次数，再开始遍历字符串S，同时开始统计T所出现的字母在S所出现的次数。 如果遍历过程中统计的字母次数和T的长度相同，说明我们遍历的得到的这个子串就是一个 Window Substring，满足条件！记录这个subString，开始缩小这个Window Substring，直到条件不满足 继续遍历寻找下一个 Window Substring。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    string minWindow(string s, string t) &#123;</span><br><span class="line">        string ans = "";</span><br><span class="line">        if(t.length() &gt; s.length()) return ans;</span><br><span class="line">        </span><br><span class="line">        vector&lt;int&gt; countTable(256,0);</span><br><span class="line">        </span><br><span class="line">        for_each(t.begin(), t.end(), [&amp;](const char ch)&#123;</span><br><span class="line">            countTable[ch]++;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        vector&lt;int&gt; foundTable(256,0);</span><br><span class="line">        queue&lt;unsigned long&gt; Q;</span><br><span class="line">        unsigned long maxLen(s.length()),count(0);</span><br><span class="line">        for(size_t i = 0;i&lt;s.length();i++)&#123;</span><br><span class="line">            if(countTable[s[i]] &gt; 0)&#123;</span><br><span class="line">                foundTable[s[i]] ++;</span><br><span class="line">                Q.push(i);</span><br><span class="line">                if(foundTable[s[i]] &lt;= countTable[s[i]]) count++;</span><br><span class="line">                if(count == t.length())&#123;</span><br><span class="line">                    unsigned long idx;</span><br><span class="line">                    do &#123;</span><br><span class="line">                        idx = Q.front();</span><br><span class="line">                        Q.pop();</span><br><span class="line">                        foundTable[s[idx]]--;</span><br><span class="line">                    &#125; while (foundTable[s[idx]] &gt;= countTable[s[idx]]);</span><br><span class="line">                    if(i-idx &lt; maxLen) ans = s.substr(idx,i-idx+1),maxLen = ans.length();</span><br><span class="line">                    count --;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/Minimum%20Window%20Substring.png" alt="Accepted"></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/">LeetCode</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2015-11-24-为iOS建立 Travis CI" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/24/2015-11-24-为iOS建立 Travis CI/">为iOS建立 Travis CI</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/11/24/2015-11-24-为iOS建立 Travis CI/" class="article-date">
  <time datetime="2015-11-24T00:00:00.000Z" itemprop="datePublished">2015-11-24</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS/">iOS</a><span>></span><a class="article-category-link" href="/categories/iOS/持续集成/">持续集成</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://objccn.io/issue-6-5/" target="_blank" rel="external">为iOS建立 Travis CI</a></p>
<p>我给自己的GMYHotSpotView项目 关联了这个 持续集成的工具 .travis.yml文件编写如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">language: objective-c</span><br><span class="line">script: xcodebuild -workspace GMYHotSpotView.xcworkspace -scheme GMYHotSpotView</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.travis-ci.com/user/languages/objective-c/" target="_blank" rel="external">Building an Objective-C Project</a></p>
<p>我后面遇到的一个比较麻烦的问题是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Check dependencies</span><br><span class="line">Code Sign error: No code signing identities found: No valid signing identities.</span><br></pre></td></tr></table></figure>
<p>最后修改.travis.yml文件，主要是新增了 <strong> CODE_SIGN_IDENTITY=”” CODE_SIGNING_REQUIRED=NO </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## http://lint.travis-ci.org/</span><br><span class="line">language: objective-c</span><br><span class="line">xcode_workspace: GMYHotSpotView.xcworkspace</span><br><span class="line">xcode_scheme: GMYHotSpotView</span><br><span class="line">script: xcodebuild -workspace GMYHotSpotView.xcworkspace -scheme GMYHotSpotView CODE_SIGN_IDENTITY=&quot;&quot; CODE_SIGNING_REQUIRED=NO</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/travis-ci1.png" alt="CI"></p>
<p>指示灯是可以拿来使用的  <a href="https://travis-ci.org/778477/GMYHotSpotView" target="_blank" rel="external"><img src="https://travis-ci.org/778477/GMYHotSpotView.svg?branch=master" alt="Build Status"></a></p>
<p><del>GitHub上还有一个很完善的YAML配置 <a href="https://github.com/BoltsFramework/Bolts-iOS/blob/master/.travis.yml" target="_blank" rel="external">https://github.com/BoltsFramework/Bolts-iOS/blob/master/.travis.yml</a></del> <strong>这个没啥卵用</strong></p>
<blockquote>
<p><a href="http://www.infoq.com/cn/articles/build-ios-continuous-integration-platform-part3" target="_blank" rel="external">构建iOS持续集成平台（三）——CI服务器与自动化部署 @infoQ</a></p>
<p><a href="http://stackoverflow.com/questions/27671854/travis-ci-fails-to-build-with-a-code-signing-error" target="_blank" rel="external">http://stackoverflow.com/questions/27671854/travis-ci-fails-to-build-with-a-code-signing-error</a></p>
<p><a href="http://stackoverflow.com/questions/27671854/travis-ci-fails-to-build-with-a-code-signing-error" target="_blank" rel="external">http://stackoverflow.com/questions/27671854/travis-ci-fails-to-build-with-a-code-signing-error</a></p>
</blockquote>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-2015-10-23-Valid-Number" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/23/2015-10-23-Valid-Number/">Vaild Number</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/10/23/2015-10-23-Valid-Number/" class="article-date">
  <time datetime="2015-10-23T00:00:00.000Z" itemprop="datePublished">2015-10-23</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a><span>></span><a class="article-category-link" href="/categories/Algorithm/LeetCode/">LeetCode</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://leetcode.com/submissions/detail/43806015/" target="_blank" rel="external">Vaild Number</a></p>
<p>判断给定的一个字符串是否是数字。</p>
<p>Note: 题目对于数字的合法定义没有给出具体限定，你应该根据判断返回结果来调整自己的程序。 (这个超坑的，我差不多错误提交了8次。有些后台TestCase的合理性是有待讨论的<a href="https://leetcode.com/discuss/3303/the-worst-problem-i-have-ever-met-in-this-oj" target="_blank" rel="external">吐槽传送门</a>)</p>
<p>言归正传。这类题目，我们一般称为 模拟题。是因为该题目没有对应具体算法和数据结构，我们只能按照题目描述的分支情况，模拟实现。其实，这个题目我在杭电OJ上做过了。。。</p>
<p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=1409" target="_blank" rel="external">Is It a Number</a></p>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/hud-1409-accepted.png" alt="accetped"></p>
<p>当时我就是当模拟题做的，现在看来这种解法不太优雅。 看了一下 Discuss，发现大多数人使用 DFA(有限状态自动机)。城！会！玩！</p>
<p>按照这个思路，我们来动手实践一下。 首先是状态的划分，因为 鉴别是否是数字，字符集{‘0’-‘9’,’+’,’-‘,’.’,’E’}。根据数字的定义，状态是有限的。 所以我们大体划分出这么集中状态：</p>
<pre><code>1. UnkownState 起始状态，没有任何字符输入。能接受的下一步字符为 数字|正负号|小数点
2. NumberState 输入数字状态，能接受的下一步字符为 数字|小数点|科学计数法(E,e)
3. OnlyNumberState 数字接着输入小数点状态，能接受下一步字符为 数字|科学计数法(E,e)
4. OperatorState 输入运算法状态，能接受下一步字符为 数字|小数点
5. DecimalPointState 输入小数点状态，能接受下一步字符为 数字
6. ScientificState 输入科学计数法状态，能接受下一步字符为 数字|正负号
7. NoscientificState 科学计数法接着输入正负号状态，能接受下一步字符为 数字
8. IllegalState 非法输入状态 
9. EndState 终态 能接受下一步字符 为数字
</code></pre><p>这里的状态命名比较随意。 状态之间的转移是关键。最后，我们认为 2，3，9状态为合法状态。停留在其他状态的输入情况，不能认为是数字。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> State&#123;</span><br><span class="line">    UnkownState  = <span class="number">0</span>,       </span><br><span class="line">    NumberState = <span class="number">1</span>,         </span><br><span class="line">    OnlyNumberState = <span class="number">2</span>,	 </span><br><span class="line">    OperatorState = <span class="number">3</span>,      </span><br><span class="line">    DecimalPointState = <span class="number">4</span>,  </span><br><span class="line">    ScientificState = <span class="number">5</span>,    </span><br><span class="line">    NoscientificState = <span class="number">6</span>, </span><br><span class="line">    IllegalState = <span class="number">7</span>,</span><br><span class="line">    EndState,</span><br><span class="line">&#125;State;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isNumber</span><span class="params">(<span class="keyword">char</span>* s)</span> </span>&#123;</span><br><span class="line">    State state = UnkownState;</span><br><span class="line">    <span class="keyword">while</span> (*s == <span class="string">' '</span>)  s++;</span><br><span class="line">    <span class="keyword">char</span> *p = (s+<span class="built_in">strlen</span>(s)<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">while</span> (*p == <span class="string">' '</span>)  --p;</span><br><span class="line">    *(p+<span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (*s) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">            <span class="keyword">case</span> UnkownState:&#123;</span><br><span class="line">                state = IllegalState;</span><br><span class="line">                <span class="keyword">if</span>(*s == <span class="string">'+'</span> || *s == <span class="string">'-'</span>) state = OperatorState;</span><br><span class="line">                <span class="keyword">if</span>(*s &gt;= <span class="string">'0'</span> &amp;&amp; *s &lt;= <span class="string">'9'</span>) state = NumberState;</span><br><span class="line">                <span class="keyword">if</span>(*s == <span class="string">'.'</span>) state = DecimalPointState;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> NumberState:&#123;</span><br><span class="line">                state = IllegalState;</span><br><span class="line">                <span class="keyword">if</span>(*s &gt;= <span class="string">'0'</span> &amp;&amp; *s &lt;= <span class="string">'9'</span>) state = NumberState;</span><br><span class="line">                <span class="keyword">if</span>(*s == <span class="string">'.'</span>) state = OnlyNumberState;</span><br><span class="line">                <span class="keyword">if</span>(*s == <span class="string">'e'</span> || *s == <span class="string">'E'</span>) state = ScientificState;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> OnlyNumberState:&#123;</span><br><span class="line">                state = IllegalState;</span><br><span class="line">                <span class="keyword">if</span>(*s &gt;= <span class="string">'0'</span> &amp;&amp; *s &lt;= <span class="string">'9'</span>) state = OnlyNumberState;</span><br><span class="line">                <span class="keyword">if</span>(*s == <span class="string">'e'</span> || *s == <span class="string">'E'</span>) state = ScientificState;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> OperatorState:&#123;</span><br><span class="line">                state = IllegalState;</span><br><span class="line">                <span class="keyword">if</span>(*s &gt;= <span class="string">'0'</span> &amp;&amp; *s &lt;= <span class="string">'9'</span>) state = NumberState;</span><br><span class="line">                <span class="keyword">if</span>(*s == <span class="string">'.'</span> ) state = DecimalPointState;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> DecimalPointState:&#123;</span><br><span class="line">                state = IllegalState;</span><br><span class="line">                <span class="keyword">if</span>(*s &gt;= <span class="string">'0'</span> &amp;&amp; *s &lt;= <span class="string">'9'</span>) state = OnlyNumberState;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> ScientificState:&#123;</span><br><span class="line">                state = IllegalState;</span><br><span class="line">                <span class="keyword">if</span>(*s == <span class="string">'+'</span> || *s == <span class="string">'-'</span>) state = NoscientificState;</span><br><span class="line">                <span class="keyword">if</span>(*s &gt;= <span class="string">'0'</span> &amp;&amp; *s &lt;= <span class="string">'9'</span>) state = EndState;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> NoscientificState:&#123;</span><br><span class="line">                state = IllegalState;</span><br><span class="line">                <span class="keyword">if</span>(*s &gt;= <span class="string">'0'</span> &amp;&amp; *s &lt;=<span class="string">'9'</span>) state = EndState;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> EndState:&#123;</span><br><span class="line">                state = IllegalState;</span><br><span class="line">                <span class="keyword">if</span>(*s &gt;= <span class="string">'0'</span> &amp;&amp; *s &lt;=<span class="string">'9'</span>) state = EndState;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> IllegalState:&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        s++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (state == NumberState || state == OnlyNumberState || state == EndState);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span>(gets(str))&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s %s\n"</span>,str,isNumber(str) ? <span class="string">"is a Number"</span>:<span class="string">"isn't a Number"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/778477/778477.github.io/master/img/vaild-number-accepted.png" alt="accepeted"></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/">LeetCode</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
      </nav>
    </section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 miaoyou.gmy&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div>
</body>
</html>